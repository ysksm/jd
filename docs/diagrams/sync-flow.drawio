<mxfile host="app.diagrams.net" modified="2024-12-15T10:00:00.000Z" agent="jira-db" etag="sync-flow" version="22.0.0" type="device">
  <diagram id="sync-overview" name="1. 同期フロー概要">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title1" value="jira-db データ同期フロー概要" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="400" y="20" width="300" height="40" as="geometry" />
        </mxCell>

        <!-- Start -->
        <mxCell id="start" value="sync コマンド開始" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="80" y="80" width="120" height="50" as="geometry" />
        </mxCell>

        <!-- Checkpoint Check -->
        <mxCell id="checkpoint_check" value="チェックポイント&#xa;存在?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="80" y="170" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="edge1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="start" target="checkpoint_check">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Full Sync -->
        <mxCell id="full_sync" value="フルSync&#xa;(全件取得)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="240" y="185" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="edge2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="checkpoint_check" target="full_sync">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="label_no" value="No" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="200" y="185" width="30" height="20" as="geometry" />
        </mxCell>

        <!-- Incremental Sync -->
        <mxCell id="inc_sync" value="差分Sync&#xa;(更新分のみ)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="80" y="290" width="120" height="50" as="geometry" />
        </mxCell>
        <mxCell id="edge3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="checkpoint_check" target="inc_sync">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="label_yes" value="Yes" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="100" y="255" width="30" height="20" as="geometry" />
        </mxCell>

        <!-- JQL Generation -->
        <mxCell id="jql_gen" value="JQLクエリ生成" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="240" y="290" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="edge4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="full_sync" target="jql_gen">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="inc_sync" target="jql_gen">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- JIRA API -->
        <mxCell id="jira_api" value="JIRA API&#xa;/rest/api/3/search/jql" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="400" y="275" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="edge6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="jql_gen" target="jira_api">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Batch Process -->
        <mxCell id="batch_process" value="バッチ処理&#xa;(100件/回)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="560" y="290" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="edge7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="jira_api" target="batch_process">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Save to DB -->
        <mxCell id="save_db" value="DuckDBに保存" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="700" y="275" width="100" height="80" as="geometry" />
        </mxCell>
        <mxCell id="edge8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="batch_process" target="save_db">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Save Checkpoint -->
        <mxCell id="save_checkpoint" value="チェックポイント保存&#xa;(settings.json)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="840" y="290" width="130" height="50" as="geometry" />
        </mxCell>
        <mxCell id="edge9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="save_db" target="save_checkpoint">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- More Pages Check -->
        <mxCell id="more_pages" value="次ページ&#xa;あり?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="865" y="390" width="80" height="70" as="geometry" />
        </mxCell>
        <mxCell id="edge10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="save_checkpoint" target="more_pages">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Loop Back -->
        <mxCell id="edge11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="more_pages" target="jira_api">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="460" y="425" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="label_yes2" value="Yes" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="500" y="405" width="30" height="20" as="geometry" />
        </mxCell>

        <!-- Metadata Sync -->
        <mxCell id="metadata_sync" value="メタデータ同期&#xa;(ステータス/優先度/&#xa;課題タイプ等)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="700" y="470" width="130" height="60" as="geometry" />
        </mxCell>
        <mxCell id="edge12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="more_pages" target="metadata_sync">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="label_no2" value="No" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="850" y="455" width="30" height="20" as="geometry" />
        </mxCell>

        <!-- Verification -->
        <mxCell id="verification" value="データ整合性検証" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="520" y="480" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="edge13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="metadata_sync" target="verification">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Clear Checkpoint -->
        <mxCell id="clear_checkpoint" value="チェックポイント&#xa;クリア" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="340" y="470" width="110" height="50" as="geometry" />
        </mxCell>
        <mxCell id="edge14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="verification" target="clear_checkpoint">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- End -->
        <mxCell id="end" value="同期完了" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="160" y="475" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="edge15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="clear_checkpoint" target="end">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Legend -->
        <mxCell id="legend_box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#666666;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="560" width="300" height="140" as="geometry" />
        </mxCell>
        <mxCell id="legend_title" value="凡例" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="50" y="565" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend1" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="50" y="590" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend1_text" value="処理ステップ" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="90" y="590" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend2" value="" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="50" y="620" width="30" height="25" as="geometry" />
        </mxCell>
        <mxCell id="legend2_text" value="判断 / チェックポイント" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="90" y="620" width="140" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend3" value="" style="shape=cylinder3;whiteSpace=wrap;html=1;size=10;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="50" y="650" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend3_text" value="外部API / データベース" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="90" y="655" width="140" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend4" value="" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="200" y="590" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend4_text" value="開始 / 終了" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="240" y="590" width="80" height="20" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>

  <diagram id="incremental-sync" name="2. 差分更新の仕組み">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title2" value="差分更新（Incremental Sync）の仕組み" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="350" y="20" width="400" height="40" as="geometry" />
        </mxCell>

        <!-- Timeline -->
        <mxCell id="timeline" value="" style="endArrow=classic;html=1;strokeWidth=3;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="80" y="120" as="sourcePoint" />
            <mxPoint x="1000" y="120" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="timeline_label" value="時間軸 (updated フィールド)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="480" y="80" width="200" height="30" as="geometry" />
        </mxCell>

        <!-- First Sync -->
        <mxCell id="sync1_box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e6f2ff;strokeColor=#6c8ebf;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="80" y="160" width="400" height="180" as="geometry" />
        </mxCell>
        <mxCell id="sync1_title" value="1回目のSync（フルSync）" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontStyle=1;fontSize=14" vertex="1" parent="1">
          <mxGeometry x="180" y="165" width="200" height="30" as="geometry" />
        </mxCell>

        <mxCell id="sync1_jql" value="JQL: project = PROJ&#xa;ORDER BY updated ASC, key ASC" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;spacingLeft=10" vertex="1" parent="1">
          <mxGeometry x="100" y="200" width="250" height="50" as="geometry" />
        </mxCell>

        <!-- Issues in First Sync -->
        <mxCell id="issue1" value="PROJ-1&#xa;12/01" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="100" y="270" width="60" height="50" as="geometry" />
        </mxCell>
        <mxCell id="issue2" value="PROJ-2&#xa;12/05" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="170" y="270" width="60" height="50" as="geometry" />
        </mxCell>
        <mxCell id="issue3" value="PROJ-3&#xa;12/10" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="240" y="270" width="60" height="50" as="geometry" />
        </mxCell>
        <mxCell id="issue4" value="PROJ-4&#xa;12/15" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="310" y="270" width="60" height="50" as="geometry" />
        </mxCell>
        <mxCell id="issue5" value="PROJ-5&#xa;12/15" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="380" y="270" width="60" height="50" as="geometry" />
        </mxCell>
        <mxCell id="last_issue_marker" value="最後の課題" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontStyle=2" vertex="1" parent="1">
          <mxGeometry x="370" y="325" width="80" height="20" as="geometry" />
        </mxCell>

        <!-- Checkpoint after first sync -->
        <mxCell id="checkpoint1" value="チェックポイント保存:&#xa;last_updated_at: 12/15&#xa;last_issue_key: PROJ-5" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=10" vertex="1" parent="1">
          <mxGeometry x="500" y="200" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="arrow1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" edge="1" parent="1" source="issue5" target="checkpoint1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Second Sync -->
        <mxCell id="sync2_box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2e6;strokeColor=#d6b656;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="80" y="380" width="900" height="200" as="geometry" />
        </mxCell>
        <mxCell id="sync2_title" value="2回目のSync（差分Sync）" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontStyle=1;fontSize=14" vertex="1" parent="1">
          <mxGeometry x="180" y="385" width="200" height="30" as="geometry" />
        </mxCell>

        <mxCell id="sync2_jql" value="JQL: project = PROJ&#xa;AND updated >= '2024-12-15'&#xa;ORDER BY updated ASC, key ASC" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;spacingLeft=10" vertex="1" parent="1">
          <mxGeometry x="100" y="420" width="250" height="60" as="geometry" />
        </mxCell>

        <!-- Issues in Second Sync -->
        <mxCell id="issue5_skip" value="PROJ-5&#xa;12/15&#xa;(スキップ)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#999999;dashed=1" vertex="1" parent="1">
          <mxGeometry x="380" y="430" width="70" height="60" as="geometry" />
        </mxCell>
        <mxCell id="issue6" value="PROJ-6&#xa;12/18&#xa;(新規)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="470" y="430" width="70" height="60" as="geometry" />
        </mxCell>
        <mxCell id="issue2_updated" value="PROJ-2&#xa;12/20&#xa;(更新)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="560" y="430" width="70" height="60" as="geometry" />
        </mxCell>
        <mxCell id="issue7" value="PROJ-7&#xa;12/22&#xa;(新規)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="650" y="430" width="70" height="60" as="geometry" />
        </mxCell>

        <!-- Explanation -->
        <mxCell id="explain1" value="• PROJ-5: 前回取得済みなのでスキップ&#xa;• PROJ-6, PROJ-7: 新規作成された課題&#xa;• PROJ-2: 前回取得後に更新された課題" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=none;align=left;spacingLeft=10;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="100" y="510" width="300" height="60" as="geometry" />
        </mxCell>

        <!-- Arrow showing update -->
        <mxCell id="update_arrow" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;strokeColor=#6c8ebf;" edge="1" parent="1" source="issue2" target="issue2_updated">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="200" y="360" />
              <mxPoint x="595" y="360" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="update_label" value="updated が変更" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontStyle=2;fontColor=#6c8ebf" vertex="1" parent="1">
          <mxGeometry x="350" y="340" width="120" height="20" as="geometry" />
        </mxCell>

        <!-- Key Points -->
        <mxCell id="keypoints_box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f0f0f0;strokeColor=#666666;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="610" width="900" height="120" as="geometry" />
        </mxCell>
        <mxCell id="keypoints_title" value="差分更新のポイント" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;fontStyle=1;fontSize=14" vertex="1" parent="1">
          <mxGeometry x="100" y="615" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="keypoints_content" value="1. updated >= 'timestamp' で前回同期以降の変更のみを取得&#xa;2. ORDER BY updated ASC により古い更新から処理（決定論的順序を保証）&#xa;3. last_issue_key で同じタイムスタンプの課題を識別し、重複を回避&#xa;4. 更新された既存課題も差分として取得される（UPSERT で上書き保存）" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=10;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="100" y="645" width="850" height="80" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>

  <diagram id="checkpoint-mechanism" name="3. チェックポイント機構">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title3" value="チェックポイント機構と中断からの復旧" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="350" y="20" width="400" height="40" as="geometry" />
        </mxCell>

        <!-- Normal Flow -->
        <mxCell id="normal_box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e6ffe6;strokeColor=#82b366;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="40" y="80" width="500" height="300" as="geometry" />
        </mxCell>
        <mxCell id="normal_title" value="正常終了フロー" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontStyle=1;fontSize=14" vertex="1" parent="1">
          <mxGeometry x="220" y="85" width="140" height="30" as="geometry" />
        </mxCell>

        <mxCell id="batch1" value="バッチ1&#xa;(100件)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="60" y="130" width="80" height="50" as="geometry" />
        </mxCell>
        <mxCell id="cp1" value="CP保存" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="60" y="190" width="80" height="30" as="geometry" />
        </mxCell>

        <mxCell id="batch2" value="バッチ2&#xa;(100件)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="160" y="130" width="80" height="50" as="geometry" />
        </mxCell>
        <mxCell id="cp2" value="CP保存" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="160" y="190" width="80" height="30" as="geometry" />
        </mxCell>

        <mxCell id="batch3" value="バッチ3&#xa;(100件)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="260" y="130" width="80" height="50" as="geometry" />
        </mxCell>
        <mxCell id="cp3" value="CP保存" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="260" y="190" width="80" height="30" as="geometry" />
        </mxCell>

        <mxCell id="batch4" value="バッチ4&#xa;(最終)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="360" y="130" width="80" height="50" as="geometry" />
        </mxCell>
        <mxCell id="cp_clear" value="CPクリア" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="360" y="190" width="80" height="30" as="geometry" />
        </mxCell>

        <mxCell id="complete" value="完了" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="460" y="145" width="60" height="40" as="geometry" />
        </mxCell>

        <mxCell id="arrow_b1_b2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="cp1" target="batch2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow_b2_b3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="cp2" target="batch3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow_b3_b4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="cp3" target="batch4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow_b4_end" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="cp_clear" target="complete">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="normal_note" value="各バッチ完了後にチェックポイント保存&#xa;最終バッチ完了後にチェックポイントクリア" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="120" y="250" width="280" height="40" as="geometry" />
        </mxCell>

        <!-- Interrupted Flow -->
        <mxCell id="interrupt_box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6e6;strokeColor=#b85450;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="560" y="80" width="500" height="300" as="geometry" />
        </mxCell>
        <mxCell id="interrupt_title" value="中断からの復旧フロー" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontStyle=1;fontSize=14" vertex="1" parent="1">
          <mxGeometry x="720" y="85" width="180" height="30" as="geometry" />
        </mxCell>

        <mxCell id="int_batch1" value="バッチ1&#xa;(完了)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="580" y="130" width="70" height="50" as="geometry" />
        </mxCell>
        <mxCell id="int_cp1" value="CP保存" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="580" y="190" width="70" height="25" as="geometry" />
        </mxCell>

        <mxCell id="int_batch2" value="バッチ2&#xa;(完了)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="665" y="130" width="70" height="50" as="geometry" />
        </mxCell>
        <mxCell id="int_cp2" value="CP保存" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="665" y="190" width="70" height="25" as="geometry" />
        </mxCell>

        <mxCell id="int_batch3" value="バッチ3&#xa;(中断)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="750" y="130" width="70" height="50" as="geometry" />
        </mxCell>
        <mxCell id="error_icon" value="X" style="ellipse;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontStyle=1;fontSize=16" vertex="1" parent="1">
          <mxGeometry x="830" y="140" width="30" height="30" as="geometry" />
        </mxCell>

        <mxCell id="resume_arrow" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#82b366;dashed=1;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="700" y="240" as="sourcePoint" />
            <mxPoint x="700" y="280" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="resume_label" value="再起動" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontStyle=1;fontColor=#82b366" vertex="1" parent="1">
          <mxGeometry x="710" y="250" width="60" height="20" as="geometry" />
        </mxCell>

        <mxCell id="resume_batch2" value="バッチ2&#xa;(スキップ)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#999999;dashed=1" vertex="1" parent="1">
          <mxGeometry x="665" y="290" width="70" height="50" as="geometry" />
        </mxCell>
        <mxCell id="resume_batch3" value="バッチ3&#xa;(再開)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="750" y="290" width="70" height="50" as="geometry" />
        </mxCell>
        <mxCell id="resume_batch4" value="バッチ4" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="835" y="290" width="70" height="50" as="geometry" />
        </mxCell>
        <mxCell id="resume_complete" value="完了" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="920" y="300" width="60" height="35" as="geometry" />
        </mxCell>

        <mxCell id="arrow_r1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="resume_batch2" target="resume_batch3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow_r2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="resume_batch3" target="resume_batch4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow_r3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="resume_batch4" target="resume_complete">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="interrupt_note" value="• 最後に保存されたCPから再開&#xa;• 処理済みの課題はスキップ&#xa;• 中断したバッチから続行" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;fontSize=11;spacingLeft=10" vertex="1" parent="1">
          <mxGeometry x="580" y="345" width="220" height="50" as="geometry" />
        </mxCell>

        <!-- Checkpoint Structure -->
        <mxCell id="struct_box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff9e6;strokeColor=#d6b656;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="40" y="420" width="1020" height="250" as="geometry" />
        </mxCell>
        <mxCell id="struct_title" value="チェックポイントの構造（SyncCheckpoint）" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontStyle=1;fontSize=14" vertex="1" parent="1">
          <mxGeometry x="400" y="425" width="300" height="30" as="geometry" />
        </mxCell>

        <mxCell id="struct_diagram" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="60" y="470" width="280" height="180" as="geometry" />
        </mxCell>
        <mxCell id="struct_name" value="SyncCheckpoint" style="text;html=1;strokeColor=none;fillColor=#e1d5e7;align=center;verticalAlign=middle;fontStyle=1;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="60" y="470" width="280" height="25" as="geometry" />
        </mxCell>
        <mxCell id="struct_fields" value="last_issue_updated_at: DateTime&lt;Utc&gt;&#xa;last_issue_key: String&#xa;items_processed: usize&#xa;total_items: usize" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=10;spacingTop=5;fontSize=11;fontFamily=Courier New" vertex="1" parent="1">
          <mxGeometry x="60" y="500" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="struct_desc" value="タイムスタンプ（更新日時）&#xa;課題キー（重複回避用）&#xa;処理済み件数&#xa;総件数" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=10;spacingTop=5;fontSize=11;fontColor=#666666" vertex="1" parent="1">
          <mxGeometry x="60" y="580" width="280" height="70" as="geometry" />
        </mxCell>

        <mxCell id="json_example" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="370" y="470" width="330" height="180" as="geometry" />
        </mxCell>
        <mxCell id="json_title" value="settings.json での保存形式" style="text;html=1;strokeColor=none;fillColor=#dae8fc;align=center;verticalAlign=middle;fontStyle=1;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="370" y="470" width="330" height="25" as="geometry" />
        </mxCell>
        <mxCell id="json_content" value="{&#xa;  &quot;projects&quot;: [{&#xa;    &quot;key&quot;: &quot;PROJ&quot;,&#xa;    &quot;sync_checkpoint&quot;: {&#xa;      &quot;last_issue_updated_at&quot;: &quot;2024-12-15T14:30:00Z&quot;,&#xa;      &quot;last_issue_key&quot;: &quot;PROJ-1234&quot;,&#xa;      &quot;items_processed&quot;: 500,&#xa;      &quot;total_items&quot;: 1500&#xa;    }&#xa;  }]&#xa;}" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=10;spacingTop=5;fontSize=10;fontFamily=Courier New" vertex="1" parent="1">
          <mxGeometry x="370" y="500" width="330" height="150" as="geometry" />
        </mxCell>

        <mxCell id="key_benefit" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="730" y="470" width="310" height="180" as="geometry" />
        </mxCell>
        <mxCell id="benefit_title" value="チェックポイントの利点" style="text;html=1;strokeColor=none;fillColor=#d5e8d4;align=center;verticalAlign=middle;fontStyle=1;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="730" y="470" width="310" height="25" as="geometry" />
        </mxCell>
        <mxCell id="benefit_content" value="1. 中断耐性&#xa;   - ネットワーク障害、プロセス終了後も再開可能&#xa;&#xa;2. 効率性&#xa;   - 既に処理済みのデータを再取得しない&#xa;&#xa;3. 進捗の可視化&#xa;   - items_processed / total_items で進捗率を表示&#xa;&#xa;4. 決定論的再開&#xa;   - key による重複回避で確実に続きから再開" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=10;spacingTop=5;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="730" y="500" width="310" height="150" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>

  <diagram id="batch-processing" name="4. バッチ処理詳細">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title4" value="バッチ処理の詳細フロー" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="400" y="20" width="300" height="40" as="geometry" />
        </mxCell>

        <!-- Swimlanes -->
        <mxCell id="lane_cli" value="CLI" style="swimlane;horizontal=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="40" y="80" width="1080" height="120" as="geometry" />
        </mxCell>
        <mxCell id="cli_start" value="sync開始" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="lane_cli">
          <mxGeometry x="40" y="40" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cli_callback" value="checkpoint&#xa;保存&#xa;コールバック" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="lane_cli">
          <mxGeometry x="800" y="30" width="90" height="60" as="geometry" />
        </mxCell>
        <mxCell id="cli_save" value="settings.json&#xa;保存" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="lane_cli">
          <mxGeometry x="920" y="40" width="100" height="40" as="geometry" />
        </mxCell>

        <mxCell id="lane_usecase" value="UseCase" style="swimlane;horizontal=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="40" y="200" width="1080" height="180" as="geometry" />
        </mxCell>
        <mxCell id="uc_jql" value="JQL生成" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="lane_usecase">
          <mxGeometry x="130" y="70" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="uc_fetch" value="バッチ取得&#xa;(100件)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="lane_usecase">
          <mxGeometry x="240" y="70" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="uc_filter" value="重複&#xa;フィルタ" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="lane_usecase">
          <mxGeometry x="350" y="55" width="80" height="70" as="geometry" />
        </mxCell>
        <mxCell id="uc_save" value="DB保存&#xa;(issues)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="lane_usecase">
          <mxGeometry x="460" y="70" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="uc_history_del" value="履歴削除" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="lane_usecase">
          <mxGeometry x="560" y="70" width="70" height="40" as="geometry" />
        </mxCell>
        <mxCell id="uc_history_ins" value="履歴挿入" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="lane_usecase">
          <mxGeometry x="650" y="70" width="70" height="40" as="geometry" />
        </mxCell>
        <mxCell id="uc_checkpoint" value="チェック&#xa;ポイント&#xa;作成" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="lane_usecase">
          <mxGeometry x="750" y="60" width="80" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uc_next" value="次ページ?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="lane_usecase">
          <mxGeometry x="930" y="55" width="80" height="70" as="geometry" />
        </mxCell>

        <mxCell id="lane_db" value="DuckDB" style="swimlane;horizontal=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="40" y="380" width="1080" height="100" as="geometry" />
        </mxCell>
        <mxCell id="db_issues" value="issues&#xa;テーブル" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=10;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="lane_db">
          <mxGeometry x="460" y="20" width="80" height="60" as="geometry" />
        </mxCell>
        <mxCell id="db_history" value="change_history&#xa;テーブル" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=10;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="lane_db">
          <mxGeometry x="600" y="20" width="100" height="60" as="geometry" />
        </mxCell>

        <mxCell id="lane_api" value="JIRA API" style="swimlane;horizontal=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="40" y="480" width="1080" height="100" as="geometry" />
        </mxCell>
        <mxCell id="api_search" value="/rest/api/3/search/jql&#xa;fields=*navigable&#xa;expand=changelog" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=10;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="lane_api">
          <mxGeometry x="220" y="15" width="130" height="70" as="geometry" />
        </mxCell>

        <!-- Arrows -->
        <mxCell id="arr1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="cli_start" target="uc_jql">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arr2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="uc_jql" target="uc_fetch">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arr3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" edge="1" parent="1" source="uc_fetch" target="api_search">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arr4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="uc_fetch" target="uc_filter">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arr5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="uc_filter" target="uc_save">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arr6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" edge="1" parent="1" source="uc_save" target="db_issues">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arr7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="uc_save" target="uc_history_del">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arr8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="uc_history_del" target="uc_history_ins">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arr9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" edge="1" parent="1" source="uc_history_ins" target="db_history">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arr10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="uc_history_ins" target="uc_checkpoint">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arr11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" edge="1" parent="1" source="uc_checkpoint" target="cli_callback">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arr12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="cli_callback" target="cli_save">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arr13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" edge="1" parent="1" source="cli_save" target="uc_next">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arr14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#82b366;" edge="1" parent="1" source="uc_next" target="uc_fetch">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1010" y="440" />
              <mxPoint x="320" y="440" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="label_yes3" value="Yes" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontColor=#82b366" vertex="1" parent="1">
          <mxGeometry x="660" y="420" width="40" height="20" as="geometry" />
        </mxCell>

        <!-- Notes -->
        <mxCell id="note_box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="600" width="1080" height="140" as="geometry" />
        </mxCell>
        <mxCell id="note_title" value="処理の詳細" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;fontStyle=1;fontSize=14" vertex="1" parent="1">
          <mxGeometry x="60" y="605" width="100" height="25" as="geometry" />
        </mxCell>
        <mxCell id="note_content" value="1. JQL生成: チェックポイントがあれば「updated >= timestamp」を追加&#xa;2. バッチ取得: JIRA APIから最大100件を取得（nextPageToken でページネーション）&#xa;3. 重複フィルタ: 再開時は last_issue_key までスキップして重複を回避&#xa;4. DB保存: batch_insert で効率的に一括挿入（UPSERT）&#xa;5. 履歴削除→挿入: 課題ごとに古い履歴を削除してから最新を挿入（常に最新状態を保証）&#xa;6. チェックポイント作成: 最後の課題の updated_at と key を記録&#xa;7. コールバック: CLI層に通知して settings.json に永続化" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;fontSize=11;spacingLeft=10" vertex="1" parent="1">
          <mxGeometry x="60" y="630" width="1000" height="100" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
